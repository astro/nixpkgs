From 647923aace25f7a32b926239642600d48ba53a79 Mon Sep 17 00:00:00 2001
From: John Ericson <John.Ericson@Obsidian.Systems>
Date: Wed, 1 Sep 2021 15:38:56 +0000
Subject: [PATCH] Don't force building and installing for the build platform

Also remove `compat/` subdir from install directories.
---
 tools/compat/Makefile | 45 ++++++++++++++++---------------------------
 1 file changed, 17 insertions(+), 28 deletions(-)

diff --git a/tools/compat/Makefile b/tools/compat/Makefile
index b272934c5487..1149fb31c333 100644
--- a/tools/compat/Makefile
+++ b/tools/compat/Makefile
@@ -1,6 +1,6 @@
 #	$NetBSD: Makefile,v 1.90 2021/09/18 01:47:10 christos Exp $
 
-HOSTLIB=	nbcompat
+LIB=	nbcompat
 
 .include <bsd.hostinit.mk>
 
@@ -106,53 +106,42 @@ include/.stamp:
 
 # Install rules
 
-HOST_LIBDIR=	${TOOLDIR}/lib
-HOST_INCSDIR=	${TOOLDIR}/include
-HOST_SHAREDIR= ${TOOLDIR}/share
-
-install:	.PHONY install.lib includes install.defs.mk
-
-# Install lib${HOSTLIB}.a in ${TOOLDIR}/lib
-install.lib: .PHONY ${HOST_LIBDIR}/lib${HOSTLIB}.a
-${HOST_LIBDIR}/lib${HOSTLIB}.a: lib${HOSTLIB}.a
-	${_MKTARGET_INSTALL}
-	${HOST_INSTALL_DIR} ${HOST_LIBDIR}
-	${HOST_INSTALL_FILE} -m ${LIBMODE} ${.ALLSRC} ${.TARGET}
+install:	.PHONY includes install.defs.mk
 
 .for _f in ${INCFILES}
-HOST_INCINSTFILES+= ${HOST_INCSDIR}/compat/${_f}
-${HOST_INCSDIR}/compat/${_f}: ${_f}
+INCINSTFILES+= ${INCSDIR}/${_f}
+${INCSDIR}/${_f}: ${_f}
 	${_MKTARGET_INSTALL}
-	${HOST_INSTALL_FILE} ${.ALLSRC} ${.TARGET}
+	${INSTALL_FILE} ${.ALLSRC} ${.TARGET}
 .endfor
 
 .for _d in ${INCSUBDIRS}
-HOST_INCINSTDIRS+= ${HOST_INCSDIR}/compat/${_d}
-${HOST_INCSDIR}/compat/${_d}:
+INCINSTDIRS+= ${INCSDIR}/${_d}
+${INCSDIR}/${_d}:
 	${_MKTARGET_INSTALL}
-	${HOST_INSTALL_DIR} ${.TARGET}
+	${INSTALL_DIR} ${.TARGET}
 .endfor
 
-# Install include files in ${TOOLDIR}/include/compat
-includes: .PHONY ${HOST_INCINSTDIRS} .WAIT ${HOST_INCINSTFILES}
+# Install include files in ${INCSDIR}
+includes: .PHONY ${INCINSTDIRS} .WAIT ${INCINSTFILES}
 	@(cd include && find . -name '*.h' -print | while read f ; do \
-	    ${HOST_INSTALL_FILE} $$f ${HOST_INCSDIR}/compat/$$f ; \
+	    ${INSTALL_FILE} $$f ${INCSDIR}/$$f ; \
 	done)
 
 
 # Install defs.mk in ${TOOLDIR}/share/compat
-install.defs.mk: .PHONY ${HOST_SHAREDIR}/compat/defs.mk
-${HOST_SHAREDIR}/compat/defs.mk: defs.mk
+install.defs.mk: .PHONY ${SHAREDIR}/defs.mk
+${SHAREDIR}/defs.mk: defs.mk
 	${_MKTARGET_INSTALL}
-	${HOST_INSTALL_DIR} ${HOST_SHAREDIR}
-	${HOST_INSTALL_DIR} ${HOST_SHAREDIR}/compat
-	${HOST_INSTALL_FILE} ${.ALLSRC} ${.TARGET}
+	${INSTALL_DIR} ${SHAREDIR}
+	${INSTALL_DIR} ${SHAREDIR}/compat
+	${INSTALL_FILE} ${.ALLSRC} ${.TARGET}
 
 # bsd.hostlib.mk wants HOST_CPPFLAGS, not CPPFLAGS
 
 HOST_CPPFLAGS+=	${CPPFLAGS}
 
-.include <bsd.hostlib.mk>
+.include <bsd.lib.mk>
 
 # Use uninstalled copy of host-mkdep
 HOST_MKDEP_OBJ!= cd ${.CURDIR}/../host-mkdep && ${PRINTOBJDIR}
-- 
2.42.0

